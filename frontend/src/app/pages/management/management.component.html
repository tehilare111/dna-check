
<nb-card class="main-nb-card" status="primary" [nbSpinner]="uploadLoading" nbSpinnerStatus="primary" nbSpinnerSize="giant">
    <nb-card-header>
        <h1>ניהול יחידות והרשאות</h1>
    </nb-card-header>
    <nb-card-body>
        <div class="row">
            <div class="col-md-3">
                <button nbButton status="primary" #saveButton (click)="saveData()">שמור עץ יחידות</button>
                <tree-root #tree (activate)="onNodePickedUp($event)" (deactivate)="onNodeDeactivate($event)" [nodes]="nodes" [options]="options"></tree-root>
                <!--<nb-card *ngIf="uploadLoading" [nbSpinner]="true" nbSpinnerStatus="primary" nbSpinnerSize="giant">
                    <nb-card-body #spinnerNbCard>
                        
                    </nb-card-body>
                </nb-card>-->
            </div>
            <div class="col-md-3">
                <div *ngIf="currentNode">
                    <nb-card>
                        <nb-card-header>
                            <nb-icon icon="plus-round" pack="ion" (click)="action='add'" class="clickable"></nb-icon>
                            <nb-icon icon="edit" pack="ion" (click)="action='edit'" class="clickable"></nb-icon>
                            <nb-icon icon="trash-a" pack="ion" (click)="action='delete'" class="clickable"></nb-icon>
                        </nb-card-header>
                        <nb-card-body>
                            <div *ngIf="action=='add'">
                                <input nbInput fullwidth placeholder="הוסף יחידה" [(ngModel)]="addUnitInput">
                                <div class="buttonWrapper">
                                    <button nbButton (click)="onNodeDeactivate()">ביטול</button>
                                    <button nbButton status="primary" (click)="addUnit()">אישור</button>
                                </div>
                            </div>
                            <div *ngIf="action=='edit'">
                                <input nbInput fullwidth placeholder="ערוך שם יחידה" [(ngModel)]="editUnitInput">
                                <div class="buttonWrapper">
                                    <button nbButton (click)="onNodeDeactivate()">ביטול</button>
                                    <button nbButton status="primary" (click)="editUnit()">אישור</button>
                                </div>
                            </div>
                            <div *ngIf="action=='delete'">
                                <p>האם למחוק את היחידה?</p>
                                <div class="buttonWrapper">
                                    <button nbButton (click)="onNodeDeactivate()">ביטול</button>
                                    <button nbButton status="primary" (click)="deleteUnit()">אישור</button>
                                </div>
                            </div>
                        </nb-card-body>
                    </nb-card>  
                </div> 
            </div>
            <div class="col-md-6">
                <table [nbTreeGrid]="dataSource" [nbSort]="dataSource" (sort)="updateSort($event)">

                    <tr nbTreeGridHeaderRow *nbTreeGridHeaderRowDef="allColumns"></tr>
                    <tr nbTreeGridRow *nbTreeGridRowDef="let row; columns: allColumns"></tr>
              
                    <ng-container [nbTreeGridColumnDef]="customColumn">
                      <th nbTreeGridHeaderCell [nbSortHeader]="getSortDirection(customColumn)" *nbTreeGridHeaderCellDef>
                        {{customColumn2}}
                      </th>
                      <td nbTreeGridCell *nbTreeGridCellDef="let row">

                        {{row.data[customColumn]}}
                      </td>
                    </ng-container>
              
                    <ng-container *ngFor="let column of defaultColumns|keyvalue; let index = index"
                                  [nbTreeGridColumnDef]="column.key"
                                  [showOn]="getShowOn(index)">
                      <th nbTreeGridHeaderCell [nbSortHeader]="getSortDirection(column.key)" *nbTreeGridHeaderCellDef>
                        {{column.value}}
                      </th>
                      <td nbTreeGridCell *nbTreeGridCellDef="let row">{{row.data[column.key] || '-'}}</td>
                    </ng-container>
              
                  </table>
                  <tr>
                  </tr>
                  <div class="row show-grid">
                  <div class="col-3 col-sm-4">
                    <input type="text" fullWidth #personal name="position" nbInput  id="personal" fieldSize="medium" placeholder="מספר מזהה" [(ngModel)]=users.personalnumber>
                   </div>
                  <div class="col-3 col-sm-4">
                    <nb-select fullWidth name="permissions" status="privmary" placeholder="הרשאה" id="permissions" fieldSize="small" [(ngModel)]="users.permissions" > 
                        <nb-option *ngFor="let permiss of permission" [value]="permiss">{{[permiss]}}</nb-option>
                        </nb-select>
                  </div>
                  <div class="col-3 col-sm-4">
                    <div class="col-sm-12">
                        <button fullWidth nbButton  status="primary" (click)=updatePermissionUser(personal.value)>שנה הרשאות</button>
                    </div>       
                  </div>
                </div>
            </div>
        </div>
    </nb-card-body>
</nb-card>
